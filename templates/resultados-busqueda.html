{% extends 'base.html' %}
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/categorias.css') }}">
{% endblock %}
{% block title %} Categorías {% endblock %}

{% block content %}
<main>
  <div class="page-container">
    
    <div class="header-categorias">
      {% if busqueda %}
          <h1>Resultados para: "{{ busqueda }}"</h1>
          <p>Hemos encontrado {{ recetas|length }} receta(s) coincidente(s)</p>
          
          <div class="cont-limpiar-busqueda">
              <a href="{{ url_for('ver_categorias') }}" class="btn-limpiar-busqueda">
                  <i class='bx bx-eraser'></i> Limpiar búsqueda
              </a>
          </div>
          
          <div class="grid-recetas">
            {% for r in recetas %}
            <div class="card-receta">
              <div class="receta-photo">
                  <div class="cont-photo">
                      <img src="/receta/obtenerImagen/{{r.idReceta}}">
                  </div>
                  <span class="categoria-badge">{{ r.categoria.nombre }}</span>
      
                  {% if r.dificultad == 'Fácil' %}
                  <span class="facil-badge">{{ r.dificultad }}</span>
                  {% elif r.dificultad == 'Media' %}
                  <span class="media-badge">{{ r.dificultad }}</span>
                  {% else %}
                  <span class="dificil-badge">{{ r.dificultad }}</span>
                  {% endif %}
              </div>
              
              <div class="receta-info">
                  <h3>{{ r.nombre }}</h3>
                  <p>{{ r.descripcion }}</p>
              </div>
      
              <div class="receta-calif">
                  {% set promedio = calif.obtener_promedio(r.idReceta) %}
                  {% for i in range(1, 6) %}
                      {% if i <= promedio|int %}
                          <i class="bx bxs-star"></i>
                      {% elif i - 0.5 <= promedio and i > promedio|int %}
                          <i class="bx bxs-star-half"></i>
                      {% else %}
                          <i class="bx bx-star"></i>
                      {% endif %}
                  {% endfor %}
                  <span class="numero-calif">({{ promedio }})</span>
              </div>
      
              <form action="/receta/{{r.idReceta}}" method="get">
                <div class="btnVer">
                    <button>Ver receta</button>
                </div>
              </form>
      
            </div>
            {% endfor %}
          </div>
      {% else %}
          <h1>Explora nuestras recetas</h1>
          <p>Encuentra el platillo perfecto filtrando por tus preferencias</p>
          
      {% endif %}
    </div>


  </div>
</main>
{% endblock %}